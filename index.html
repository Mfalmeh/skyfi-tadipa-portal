<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0" />
  <title>Tadipa - SkyFi</title>
  <meta name="description"
        content="Connect to Tadipa WiFi - Fast, affordable internet for students" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Spinner styles */
    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #ffffff40;
      border-radius: 50%;
      border-top: 2px solid #ffffff;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>

<body>
  <div class="holder">
    <!-- Logo -->
    <div class="logo tadipa-logo">
      <img src="https://i.ibb.co/r99Zbs9/tadipa-Logo1-png.png" alt="Tadipa Logo" />
    </div>

    <!-- Animated orbs -->
    <div class="orb-container"></div>

    <!-- Main card -->
    <div class="container">
      <div class="welcome-text">
        <h1>Welcome To Tadipa</h1>
        <small>Stay safe. Stay comfortable.</small>
        <small>Stay connected with Tadipa!</small>
      </div>
      
  <!-- Voucher form -->
  <section id="voucher-section">
  <form id="voucher-form" action="https://api.skyfi.solutions/validate" method="POST">
    <input
      type="text"
      name="voucher" 
      id="voucher"
      placeholder="Enter Voucher Code"
      required
      pattern="[DWM][0-9]{6}" 
    />
    <p id="error-message" style="color: red;"></p>
  
          <div id="terms-container">
            <input type="checkbox" id="terms" name="terms" required />
            <label for="terms">Agree with Terms of Service</label>
          </div>

          <button type="submit" id="form-control" disabled>
            <span id="button-text">Connect</span>
          </button>
    </form>
    
  </section>

      <div class="divider"><span>Or</span></div>

      <div class="links">
        <p>Buy Voucher</p>
      </div>

      <div class="payment-logos">
        <img src="https://i.ibb.co/ZzK7YNm3/mtn.png" alt="MTN MoMo" />
        <img
          class="airtel-disabled"
          onclick="showAirtelComingSoon()"
          src="https://i.ibb.co/N23H1b7g/airtel.png"
          alt="Airtel Money"
        />
      </div>

      <div class="support">
        Need help? Call or WhatsApp
        <a href="https://wa.me/256768926395" target="_blank">0768926395</a>
      </div>
    </div>
  </div>

  <div class="footer">
    <strong>Powered by SkyFi</strong> | Affordable. Fast. For Students.<br />
    <small>&copy; 2025 Intercom Inc. - All Rights Reserved.</small><br />
    <small>Made With ❤️ by Churchill</small>
  </div>

  <!-- Payment Modal -->
  <div class="payment-modal" id="paymentModal">
    <div class="payment-modal-content">
      <h3 id="modalTitle">Processing Payment...</h3>
      <div id="modalContent"></div>
      <button class="close-modal" id="closeModalBtn" onclick="closePaymentModal()">
        Close
      </button>
    </div>
  </div>

  <!-- External scripts -->
  <script src="mobileMoneyVerify.js"></script>

  <script>
    const termsCheckbox = document.getElementById('terms');
    const connectButton = document.getElementById('form-control');

    // Disable / enable button on checkbox change
    termsCheckbox.addEventListener('change', () => {
      connectButton.disabled = !termsCheckbox.checked;
    });
  
  //Voucher Form Responsiveness 
  const voucherForm = document.getElementById('voucher-form');
  const voucherInput = document.getElementById('voucher');
  const errorMessage = document.createElement('p');
  errorMessage.id = 'error-message';
  voucherForm.appendChild(errorMessage);

  voucherForm.addEventListener('submit', async function (e) {
    e.preventDefault();
    const voucher = voucherInput.value;
    const buttonText = document.getElementById('button-text');

    // Show loading state
    connectButton.disabled = true;
    buttonText.innerHTML = '<div class="spinner"></div>';

    try {
      const response = await fetch('https://api.skyfi.solutions/validate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ voucher })
      });

      const result = await response.json();

      if (result.success) {
        window.location.href = 'https://tadipa.skyfi.solutions/success';
      } else {
        // Reset button state
        buttonText.textContent = 'Connect';
        connectButton.disabled = !termsCheckbox.checked;
        
        errorMessage.textContent = result.reason;

        // Shake + red glow
        voucherInput.classList.add('shake', 'input-error');
        setTimeout(() => {
          voucherInput.classList.remove('shake');
        }, 300);

        // Vibration
        if (navigator.vibrate) {
          navigator.vibrate(200);
        }
      }
    } catch (error) {
      // Reset button state on error
      buttonText.textContent = 'Connect';
      connectButton.disabled = !termsCheckbox.checked;
      errorMessage.textContent = 'Network error. Please try again.';
    }
  });
  </script>

  
</body>
</html>
