<!DOCTYPE html>
<html lang="en">
<head> 
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0" />
  <title>Tadipa - SkyFi</title>
  <meta name="description"
        content="Connect to Tadipa WiFi - Fast, affordable internet for students" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="holder">
    <!-- Logo -->
    <div class="logo tadipa-logo">
      <img src="https://i.ibb.co/r99Zbs9/tadipa-Logo1-png.png" alt="Tadipa Logo" />
    </div>

    <!-- Animated orbs -->
    <div class="orb-container"></div>

    <!-- Main card -->
    <div class="container">
      <div class="welcome-text">
        <h1>Welcome To Tadipa</h1>
        <small>Stay safe. Stay comfortable.</small>
        <small>Stay connected with Tadipa!</small>
      </div>
      
  <!-- Voucher form -->
  <section id="voucher-section">
  <form id="voucher-form">
    <input
      type="text"
      name="voucher" 
      id="voucher"
      placeholder="Enter Voucher Code"
      required
      pattern="[DWM][0-9]{6}" 
    />
    <p id="error-message" style="color: red;"></p>
  
          <div id="terms-container">
            <input type="checkbox" id="terms" name="terms" required />
            <label for="terms">Agree with Terms of Service</label>
          </div>

          <button type="submit" id="form-control" disabled>Connect</button>
    </form>

    <div id="loading-state" style="display: none; text-align: center; margin-top: 1em;">
  <div class="spinner"></div>
  <p>Validating voucher, hang tight...</p>
    </div>
    
  </section>

      <div class="divider"><span>Or</span></div>

      <div class="links">
        <p>Buy Voucher</p>
      </div>

      <div class="payment-logos">
        <img src="https://i.ibb.co/ZzK7YNm3/mtn.png" alt="MTN MoMo" />
        <img
          class="airtel-disabled"
          onclick="showAirtelComingSoon()"
          src="https://i.ibb.co/N23H1b7g/airtel.png"
          alt="Airtel Money"
        />
      </div>

      <div class="support">
        Need help? Call or WhatsApp
        <a href="https://wa.me/256768926395" target="_blank">0768926395</a>
      </div>
    </div>
  </div>

  <div class="footer">
    <strong>Powered by SkyFi</strong> | Affordable. Fast. For Students.<br />
    <small>&copy; 2025 Intercom Inc. - All Rights Reserved.</small><br />
    <small>Made With ❤️ by Churchill</small>
  </div>

  <!-- Payment Modal -->
  <div class="payment-modal" id="paymentModal">
    <div class="payment-modal-content">
      <h3 id="modalTitle">Processing Payment...</h3>
      <div id="modalContent"></div>
      <button class="close-modal" id="closeModalBtn" onclick="closePaymentModal()">
        Close
      </button>
    </div>
  </div>

  <!-- External scripts -->
  <script src="mobileMoneyVerify.js"></script>
  
  <!-- Submit handler -->
  <script>
  const termsCheckbox = document.getElementById('terms');
  const connectButton = document.getElementById('form-control');
  const voucherForm = document.getElementById('voucher-form');
  const voucherInput = document.getElementById('voucher');
  const errorMessage = document.getElementById('error-message');
  const loadingState = document.getElementById('loading-state');

  let errorTimeout;

  termsCheckbox.addEventListener('change', () => {
    connectButton.disabled = !termsCheckbox.checked;
  });

  voucherInput.addEventListener('input', () => {
    voucherInput.classList.remove('input-error');
    errorMessage.textContent = '';
    clearTimeout(errorTimeout);
  });

  voucherForm.addEventListener('submit', async function (e) {
    e.preventDefault();
    errorMessage.textContent = '';
    connectButton.disabled = true;
    voucherInput.disabled = true;
    loadingState.style.display = 'block';

    const voucher = voucherInput.value;

    try {
      const response = await fetch('https://api.skyfi.solutions/validate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ voucher })
      });

      const result = await response.json();

      if (result.success) {
        window.location.href = 'https://tadipa.skyfi.solutions/success';
      } else {
        errorMessage.textContent = result.reason;
        voucherInput.classList.add('shake', 'input-error');

        setTimeout(() => {
          voucherInput.classList.remove('shake');
        }, 300);

        if (navigator.vibrate) navigator.vibrate(200);

        // Fade out glow after delay if user doesn't type
        errorTimeout = setTimeout(() => {
          voucherInput.classList.remove('input-error');
        }, 4000);
      }
    } catch (err) {
      errorMessage.textContent = 'Network error. Please try again.';
    }

    connectButton.disabled = !termsCheckbox.checked;
    voucherInput.disabled = false;
    loadingState.style.display = 'none';
  });
  </script>

</body>
</html>
